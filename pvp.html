<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PVP 아레나</title>
    <link rel="icon" type="image/png" href="assets/favicon.png" />
    <style>
      :root {
        --bg: #0f1115;
        --panel: #161a21;
        --panel-2: #1c2230;
        --text: #e7ecf3;
        --muted: #aeb7c6;
        --accent: #6aa9ff;
        --ok: #43c383;
        --warn: #f6c34a;
        --danger: #ff6b6b;
      }
      body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Helvetica, Arial;
        padding: 20px;
      }
      .top-bar {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
        margin-bottom: 20px;
      }
      .top-bar h1 { margin: 0; font-size: 20px; }
      .top-bar .meta { display:flex; gap:12px; flex-wrap:wrap; font-size:13px; color:var(--muted); }
      .top-bar .meta b { color: var(--text); }
      .top-bar .sep { flex:1 1 auto; }
      button {
        background: var(--panel-2);
        color: var(--text);
        border: 1px solid rgba(142,238,255,0.2);
        border-radius: 8px;
        padding: 8px 12px;
        cursor: pointer;
        font-weight: 600;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      button.primary { background: var(--accent); color: #06122a; border-color: transparent; }
      button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(106,169,255,0.35); }
      button:disabled { opacity: 0.6; cursor: not-allowed; }
      .panels {
        display: grid;
        grid-template-columns: 1.2fr 1.4fr 1fr;
        gap: 20px;
      }
      @media (max-width: 1200px) { .panels { grid-template-columns: 1fr 1fr; } }
      @media (max-width: 870px) { .panels { grid-template-columns: 1fr; } }
      .panel {
        background: var(--panel);
        border-radius: 12px;
        border: 1px solid rgba(142, 238, 255, 0.2);
        padding: 16px;
      }
      .panel h2 { margin:0 0 12px; font-size:18px; color: var(--accent); }
      .player-card, .opponent-card {
        display:flex; flex-direction:column; gap:10px;
        background: var(--panel-2);
        border:1px solid rgba(142,238,255,0.15);
        border-radius:10px;
        padding:12px;
      }
      .subheading { font-size:14px; color:var(--muted); margin:0 0 6px; }
      .stats-grid { display:grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap:6px; font-size:13px; }
      .stats-grid .row { display:flex; justify-content:space-between; padding:4px 6px; background:rgba(0,0,0,0.25); border-radius:6px; }
      .stats-grid .label { color: var(--muted); }
      .tier-badge { display:inline-flex; align-items:center; gap:4px; font-size:12px; background:rgba(142,238,255,0.12); border:1px solid rgba(142,238,255,0.25); border-radius:999px; padding:2px 8px; }
      .opponent-list { max-height:320px; overflow:auto; display:flex; flex-direction:column; gap:8px; }
      .opponent-item { display:flex; justify-content:space-between; align-items:center; gap:10px; background:rgba(10,15,24,0.7); border:1px solid rgba(142,238,255,0.1); border-radius:10px; padding:10px; }
      .opponent-item .info { display:flex; flex-direction:column; }
      .opponent-item .name { font-weight:600; }
      .opponent-item .rating { font-size:12px; color:var(--muted); }
      .scoreboard-table { width:100%; border-collapse:collapse; margin-top:10px; }
      .scoreboard-table th, .scoreboard-table td { padding:6px 8px; border-bottom:1px solid rgba(142,238,255,0.15); text-align:left; font-size:13px; }
      .scoreboard-table th { color:var(--muted); font-weight:600; }
      .battle-arena { background: linear-gradient(135deg, #1a1f2e, #111624); border-radius: 12px; border:1px solid rgba(142,238,255,0.2); padding: 16px; position: relative; display:flex; flex-direction:column; gap:16px; }
      .battle-status { display:grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap:20px; margin-bottom:16px; }
      @media (max-width: 720px) { .battle-status { grid-template-columns: 1fr; } }
      .fighter-card { background: rgba(8,12,20,0.65); border-radius: 12px; border:1px solid rgba(142,238,255,0.2); padding:14px; display:flex; flex-direction:column; gap:10px; position:relative; overflow:hidden; }
      .fighter-card.enemy { border-color: rgba(255,107,107,0.4); }
      .fighter-header { display:flex; align-items:center; justify-content:space-between; gap:10px; font-size:15px; font-weight:600; }
      .power-value { font-size:18px; font-weight:700; color:var(--accent); }
      .fighter-card.enemy .power-value { color: var(--danger); }
      .character-frame { background: rgba(0,0,0,0.42); border-radius: 10px; border:1px solid rgba(142,238,255,0.15); height:140px; display:flex; align-items:center; justify-content:center; overflow:hidden; }
      .character-frame img { width:100%; height:100%; object-fit:contain; transition: opacity 0.2s ease; }
      .pet-label { font-size:12px; color:var(--muted); text-align:center; margin-top:4px; }
      .hp-bar { height:22px; background: rgba(255,255,255,0.08); border-radius:12px; overflow:hidden; position:relative; }
      .hp-fill { height:100%; background: linear-gradient(90deg, #43c383, #6ecb9b); transition: width 0.45s ease; }
      .fighter-card.enemy .hp-fill { background: linear-gradient(90deg, #ff6b6b, #ff9966); }
      .hp-text { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:600; text-shadow:0 1px 3px rgba(0,0,0,0.6); }
      .stage-record { font-size:12px; color:var(--muted); text-align:center; margin-top:4px; }
      .battle-result-banner { position:absolute; top:12px; left:50%; transform:translateX(-50%); font-size:36px; font-weight:700; pointer-events:none; text-shadow:0 0 16px currentColor; display:none; }
      .battle-result-banner.victory { color:#ffd700; animation:victoryBanner 1.4s ease-out forwards; }
      .battle-result-banner.defeat { color:#ff6b6b; animation:defeatBanner 1.4s ease-out forwards; }
      .battle-result-banner.draw { color:var(--warn); animation:drawBanner 1.4s ease-out forwards; }
      .battle-result-banner.timeout { color:var(--muted); animation:drawBanner 1.4s ease-out forwards; }
      @keyframes victoryBanner { 0% { transform:translate(-50%, -60%) scale(0); opacity:0; } 30% { opacity:1; } 100% { transform:translate(-50%, -60%) scale(1); opacity:1; } }
      @keyframes defeatBanner { 0% { transform:translate(-50%, -60%) scale(0); opacity:0; } 100% { transform:translate(-50%, -60%) scale(1); opacity:0.8; } }
      @keyframes drawBanner { 0% { transform:translate(-50%, -60%) scale(0.85); opacity:0; } 100% { transform:translate(-50%, -60%) scale(1); opacity:1; } }
      .action-hit { box-shadow:0 0 0 2px rgba(106,169,255,0.45); }
      .action-miss { box-shadow:0 0 0 2px rgba(174,183,198,0.45); }
      .action-defend { box-shadow:0 0 0 2px rgba(67,195,131,0.45); }
      .action-critical { box-shadow:0 0 0 2px rgba(255,219,87,0.6); }
      .opponent-item.selected { border-color: rgba(106,169,255,0.6); box-shadow:0 0 0 1px rgba(106,169,255,0.4); }
      .opponent-item .meta { display:flex; gap:8px; font-size:11px; color:var(--muted); margin-top:4px; }
      .opponent-item .time { font-size:11px; color:var(--muted); margin-top:4px; }
      .battle-log { background: rgba(0,0,0,0.35); border-radius:10px; border:1px solid rgba(142,238,255,0.15); padding:12px; max-height:260px; overflow:auto; font-size:13px; display:flex; flex-direction:column; gap:6px; }
      .log-line { padding:4px 6px; border-left:3px solid rgba(142,238,255,0.25); background:rgba(8,12,20,0.6); border-radius:6px; }
      .log-line.win { border-color: var(--ok); }
      .log-line.loss { border-color: var(--danger); }
      .vs-section { display:flex; flex-direction:column; gap:14px; }
      .versus-summary { display:flex; flex-wrap:wrap; gap:12px; font-size:13px; color:var(--muted); }
      .versus-summary span { background:rgba(142,238,255,0.12); border:1px solid rgba(142,238,255,0.2); border-radius:999px; padding:4px 10px; }
      .muted { color: var(--muted); }
      .ok { color: var(--ok); }
      .danger { color: var(--danger); }
      .warn { color: var(--warn); }
      .season-banner { margin-bottom:20px; padding:16px; border-radius:12px; border:1px solid rgba(142,238,255,0.25); background:linear-gradient(135deg, rgba(41,64,122,0.45), rgba(16,24,40,0.85)); display:flex; flex-direction:column; gap:8px; box-shadow:0 8px 24px rgba(0,0,0,0.25); }
      .season-banner.active { border-color: rgba(106,169,255,0.6); box-shadow:0 0 18px rgba(106,169,255,0.35); }
      .season-status-line { display:flex; flex-wrap:wrap; gap:12px; align-items:center; font-size:14px; }
      .season-status-line strong { font-size:16px; color:var(--accent); }
      .season-reward { color:#ffd86b; font-weight:600; }
      .season-timing { font-size:12px; color:var(--muted); }
      .season-admin, .season-history { margin-bottom:20px; }
      .season-admin .form-row { display:flex; flex-wrap:wrap; gap:12px; align-items:center; margin-bottom:12px; }
      .season-admin label { width:120px; font-size:13px; color:var(--muted); }
      .season-admin input { flex:1 1 140px; padding:6px 10px; border-radius:8px; border:1px solid rgba(142,238,255,0.3); background:rgba(10,14,24,0.6); color:var(--text); }
      .season-admin-actions { display:flex; gap:10px; flex-wrap:wrap; }
      .season-message { margin-top:10px; font-size:12px; color:var(--muted); }
      .season-history-content { display:flex; flex-direction:column; gap:8px; font-size:12px; color:var(--muted); }
      .season-history-content .winner-line { display:flex; flex-wrap:wrap; gap:8px; padding:8px 10px; border-radius:8px; background:rgba(0,0,0,0.25); border:1px solid rgba(142,238,255,0.2); }
      .season-history-content .winner-line strong { color:var(--accent); }
      .season-history-empty { font-size:12px; color:var(--muted); }
      button.danger { background: var(--danger); color: #06122a; border-color: transparent; }
    </style>
  </head>
  <body data-page="pvp">
    <div class="container">
      <div class="top-bar">
        <h1>PVP 아레나</h1>
        <div class="meta">
          <span>플레이어: <b id="whoamiPvp">-</b></span>
          <span>전적: <b id="pvpRecord">0승 0패</b></span>
          <span>출전 상태: <b id="pvpRegistrationStatus">미등록</b></span>
        </div>
        <span class="sep"></span>
        <button id="pvpRegisterBtn">출전 등록</button>
        <button id="pvpUnregisterBtn" disabled>출전 취소</button>
        <button id="toGacha" class="primary">가챠 페이지</button>
        <button id="toBattle">전투 페이지</button>
        <button id="resetPvpData" style="display:none;">랭킹 초기화</button>
        <button id="logoutBtn">로그아웃</button>
      </div>

      <div class="season-banner" id="pvpSeasonBanner">
        <div class="season-status-line">
          <strong id="pvpSeasonStatusText">시즌 준비중</strong>
          <span class="season-reward" id="pvpSeasonRewardSummary">상금: -</span>
        </div>
        <div class="season-timing" id="pvpSeasonTiming">-</div>
      </div>

      <div class="panel season-admin" id="pvpSeasonAdminPanel" style="display:none;">
        <h2>시즌 관리</h2>
        <div class="form-row">
          <label for="pvpRewardGoldInput">골드 상금</label>
          <input type="number" id="pvpRewardGoldInput" min="0" step="1" value="0" />
        </div>
        <div class="form-row">
          <label for="pvpRewardDiamondsInput">다이아 상금</label>
          <input type="number" id="pvpRewardDiamondsInput" min="0" step="1" value="0" />
        </div>
        <div class="form-row">
          <label for="pvpRewardPointsInput">포인트 상금</label>
          <input type="number" id="pvpRewardPointsInput" min="0" step="1" value="0" />
        </div>
        <div class="season-admin-actions">
          <button id="pvpSeasonStartBtn" class="primary">선포</button>
          <button id="pvpSeasonEndBtn" class="danger">종료</button>
        </div>
        <div class="season-message" id="pvpSeasonAdminMsg"></div>
      </div>

      <div class="panel season-history" id="pvpSeasonHistoryPanel" style="display:none;">
        <h2>지난 시즌 결과</h2>
        <div class="season-history-content" id="pvpSeasonHistoryContent">
          <div class="season-history-empty">아직 시즌 기록이 없습니다.</div>
        </div>
      </div>

      <div class="panels">
        <div class="panel">
          <h2>플레이어 정보</h2>
          <div class="player-card" id="playerCard">
            <div class="subheading">나의 장비</div>
            <div id="playerEquipment"></div>
            <div class="subheading" style="margin-top:10px;">총합 스탯</div>
            <div class="stats-grid" id="playerStats"></div>
          </div>
          <div class="panel" style="margin-top:16px; background:rgba(0,0,0,0.3);">
            <h2 style="margin-bottom:10px;">내 PVP 히스토리</h2>
            <div class="battle-log" id="personalHistory"></div>
          </div>
        </div>

        <div class="panel">
          <h2>도전 상대</h2>
          <div class="opponent-list" id="opponentList"></div>
          <div class="panel" style="margin-top:16px; background:rgba(0,0,0,0.3);">
            <h2 style="margin-bottom:10px;">PVP 전투</h2>
            <div class="vs-section">
              <div class="battle-arena" id="pvpBattleArena">
                <div class="battle-result-banner" id="pvpBattleBanner"></div>
                <div class="battle-status">
                  <div class="fighter-card" id="pvpLeftCard">
                    <div class="fighter-header">
                      <span id="pvpLeftName">출전 등록 필요</span>
                      <span class="power-value" id="pvpLeftPower">0</span>
                    </div>
                    <div class="character-frame">
                      <img
                        id="pvpLeftCharacterImg"
                        src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http://www.w3.org/2000/svg%22%20width%3D%2264%22%20height%3D%2264%22%20viewBox%3D%220%200%2064%2064%22%3E%3Crect%20width%3D%2264%22%20height%3D%2264%22%20rx%3D%2210%22%20ry%3D%2210%22%20fill%3D%22%23d0d0d0%22/%3E%3Cpath%20d%3D%22M32%2018a10%2010%200%201%201%200%2020a10%2010%200%200%201%200-20zm0%2024c10.5%200%2019%206.3%2019%2014v4H13v-4c0-7.7%208.5-14%2019-14z%22%20fill%3D%22%23808080%22/%3E%3C/svg%3E"
                        alt="도전자"
                      />
                    </div>
                    <div class="pet-label" id="pvpLeftPet">펫 없음</div>
                    <div class="hp-bar">
                      <div class="hp-fill" id="pvpLeftHpFill"></div>
                      <div class="hp-text" id="pvpLeftHpText">0 / 0</div>
                    </div>
                    <div class="stage-record" id="pvpLeftRecord">---</div>
                    <div class="stats-grid" id="pvpLeftStats"></div>
                  </div>
                  <div class="fighter-card enemy" id="pvpRightCard">
                    <div class="fighter-header">
                      <span id="pvpRightName">상대를 선택하세요</span>
                      <span class="power-value" id="pvpRightPower">0</span>
                    </div>
                    <div class="character-frame">
                      <img
                        id="pvpRightCharacterImg"
                        src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http://www.w3.org/2000/svg%22%20width%3D%2264%22%20height%3D%2264%22%20viewBox%3D%220%200%2064%2064%22%3E%3Crect%20width%3D%2264%22%20height%3D%2264%22%20rx%3D%2210%22%20ry%3D%2210%22%20fill%3D%22%23d0d0d0%22/%3E%3Cpath%20d%3D%22M32%2018a10%2010%200%201%201%200%2020a10%2010%200%200%201%200-20zm0%2024c10.5%200%2019%206.3%2019%2014v4H13v-4c0-7.7%208.5-14%2019-14z%22%20fill%3D%22%23808080%22/%3E%3C/svg%3E"
                        alt="상대"
                      />
                    </div>
                    <div class="pet-label" id="pvpRightPet">펫 없음</div>
                    <div class="hp-bar">
                      <div class="hp-fill" id="pvpRightHpFill"></div>
                      <div class="hp-text" id="pvpRightHpText">0 / 0</div>
                    </div>
                    <div class="stage-record" id="pvpRightRecord">---</div>
                    <div class="stats-grid" id="pvpRightStats"></div>
                  </div>
                </div>
              </div>
              <div class="versus-summary" id="versusSummary"></div>
              <div class="battle-log" id="battleLog"></div>
              <button id="challengeBtn" class="primary" disabled>도전하기</button>
            </div>
          </div>
        </div>

        <div class="panel">
          <h2>랭킹</h2>
          <table class="scoreboard-table" id="rankingTable">
            <thead>
              <tr><th>순위</th><th>플레이어</th><th>전적</th><th>승률</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <script type="module" src="pvp.js"></script>
    <script type="module" src="navigation.js"></script>
    <script type="module" src="mailbox.js"></script>
  </body>
</html>
